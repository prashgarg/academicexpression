---
title: "2_fig_2_to_4"
author: "Prashant Garg"
date: "2024-06-07"
output: html_document
---
# Goal: create Figures 2 to 4, and Appendix Figures A4 to A6

----------------------------------------------------------------------


# Layperson Explanation:
Load Data: The script starts by loading datasets from CSV files into dataframes.
Prepare Variables and Names: It defines lists and mappings for variables and their labels.
Function to Calculate Statistics: A function is defined to calculate mean, standard error, and confidence intervals.
Main Figures: The script calculates statistics and creates plots for different groups of variables (climate, economic, behavioral). Each figure involves similar steps: calculating stats for different subgroups, labeling variables, and plotting data.
Appendix Figures: Similar to the main figures, but with additional normalization relative to the US general population.
Save Plots: Optionally save the plots as high-resolution images.

-----------------------------------------------------------------------

# Pseudocode:

# Load Data
LOAD datasets 'repl_df.csv' and 'users_df.csv' into dataframes 'repl_df' and 'users_df'

# Prepare Variables and Names
DEFINE variable list 'variables' for analysis
DEFINE mapping 'topic_label_mapping' for variable labels

DEFINE groups of variables 'clim_var', 'econ_var', 'beh_var' for different analysis sections

# Function to Calculate Statistics
DEFINE function 'calculate_stats' to calculate mean, standard error, and confidence intervals for a given data column

# Main Figures

## Figure 2: Climate Variables
FOR each variable in 'clim_var'
    CALCULATE stats for the whole dataset, females, males, STEM, social sciences, humanities
    CALCULATE stats for high and low reach and expertise in climate, top and non-top 100 universities, US and non-US
    CALCULATE stats for climate experts and non-experts
    COMBINE results into dataframes for field, reach by expertise, gender, rank, and country groups

    LABEL variables and ensure correct factor levels
    ADD main mean for each label
    PLOT data with ggplot, including points and error bars, faceted by group and label

## Figure 3: Economic Variables
FOR each variable in 'econ_var'
    REPEAT the above steps for calculating stats and plotting
    CALCULATE stats for high and low reach and expertise in economy and culture

## Figure 4: Behavioral Variables
FOR each variable in 'beh_var'
    REPEAT the above steps for calculating stats and plotting
    CALCULATE stats for high and low reach and credibility

# Appendix Figures

## Appendix Figure 4: Climate Variables
FOR each variable in 'clim_var'
    CALCULATE stats as for Figure 2
    CALCULATE stats for US users
    NORMALIZE values relative to US general population
    PLOT data with ggplot, faceted by group and label

## Appendix Figure 5: Economic Variables
FOR each variable in 'econ_var'
    CALCULATE stats as for Figure 3
    CALCULATE stats for US users
    NORMALIZE values relative to US general population
    PLOT data with ggplot, faceted by group and label

## Appendix Figure 6: Behavioral Variables
FOR each variable in 'beh_var'
    CALCULATE stats as for Figure 4
    CALCULATE stats for US users
    NORMALIZE values relative to US general population
    PLOT data with ggplot, faceted by group and label

# Save Plots
OPTIONALLY save each plot as a high-resolution image file

# Conducts Statistical Tests and Provides Wide Range of Evidence for Statistical Reporting
----------------------------------------------------------------------



# data
```{r}
repl_df <- read_csv( "../2_data/repl_df.csv")
users_df <- read_csv( "../2_data/users_df.csv")
```



# prep
variables and names
```{r}
variables <- c("egocentrism", "toxicity", "emotionality", "stance_climate_action", "pro_techno_prop", "pro_beh_prop",  "stance_econ_collectivism", "stance_cultural_liberalism") 

topic_label_mapping <- c(
  "egocentrism" = "Egocentrism",
  "toxicity" = "Toxicity",
  "emotionality" = "Emotionality/\nReasoning",
  "stance_climate_action" = "Climate\nAction",
  "pro_techno_prop" = "Techno-\nOptimism",
  "pro_beh_prop" = "Behavioural\nAdjustment",
  "stance_econ_collectivism" = "Economic\nCollectivism",
  "stance_cultural_liberalism" = "Cultural\nliberalism"
)

clim_var <- c("pro_techno_prop", "pro_beh_prop", "stance_climate_action")
econ_var <- c("stance_cultural_liberalism",  "stance_econ_collectivism")
beh_var <- c("emotionality", "toxicity",  "egocentrism")
```

function to calc
```{r}
# Function to calculate mean, standard error, and confidence intervals for given data column
calculate_stats <- function(data, var_name) {
  var_data <- na.omit(data[[var_name]])  # Remove NA values
  n <- length(var_data)
  mean_val <- mean(var_data)
  std_error <- sd(var_data) / sqrt(n)
  z <- qnorm(0.975)  # 95% CI
  ci_lower <- mean_val - z * std_error
  ci_upper <- mean_val + z * std_error
  
  data.frame(
    Term = var_name,
    Mean = mean_val,
    StdError = std_error,
    CI_lower = ci_lower,
    CI_upper = ci_upper
  )
}
```

# Main Figures
Figure 2
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(clim_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_climate==1), .x))
stats_pol_type_H_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_climate==1), .x))
stats_pol_type_L_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_climate==1), .x))
stats_pol_type_L_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_climate==1), .x))

stats_pol_ranking_1_100 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1-100"), .x))
stats_pol_ranking_1_100$Type <- "1-100"

stats_pol_ranking_101_500 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "101-500"), .x))
stats_pol_ranking_101_500$Type <- "101-500"

stats_pol_ranking_501_1500 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "501-1500"), .x))
stats_pol_ranking_501_1500$Type <- "501-1500"

stats_pol_ranking_1501 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1501+"), .x))
stats_pol_ranking_1501$Type <- "1501+"

stats_pol_is_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_is_climate_expert <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_climate_expert==1), .x))
stats_pol_does_do_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_climate_expert==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_climate <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_climate, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_climate, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_climate, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_climate, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_climate$Type <- factor(stats_pol_reach_by_exp_climate$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))

stats_pol_rank <- bind_rows(
  stats_pol_ranking_1_100,
  stats_pol_ranking_101_500,
  stats_pol_ranking_501_1500,
  stats_pol_ranking_1501
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "101-500", "501-1500", "1501+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")

stats_pol_main$Label <- factor(stats_pol_main$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_reach_by_exp_climate$Label <- factor(stats_pol_reach_by_exp_climate$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = clim_var, labels = topic_label_mapping[clim_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_exp_climate, stats_pol_gender, stats_pol_rank, stats_pol_US)

stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "101-500", "501-1500", "1501+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1501+", "501-1500","101-500", "1-100",  
  "Non-US", "US"
))

# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "101-500" = "#33A02C", "501-1500" = "#e31a1c", "1501+" = "#ff7f00",
  "US" = "red3", "Non-US" = "grey40"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Climate\nAction","Techno-\nOptimism", "Behavioural\nAdjustment")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% clim_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    
    # strip.background = element_rect(fill = NA, color = NA),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)

# optionally, save the plot to view it clearly as it appears in the paper
ggsave("fig2.jpg", p_all, width = 20, height = 22, dpi = 300)

```

Figure 3
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(econ_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_econ==1), .x))
stats_pol_type_H_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_econ==1), .x))
stats_pol_type_L_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_econ==1), .x))
stats_pol_type_L_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_econ==1), .x))

stats_pol_type_H_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_cult==1), .x))
stats_pol_type_H_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_cult==1), .x))
stats_pol_type_L_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_cult==1), .x))
stats_pol_type_L_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_cult==1), .x))

stats_pol_ranking_1_100 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1-100"), .x))
stats_pol_ranking_1_100$Type <- "1-100"

stats_pol_ranking_101_500 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "101-500"), .x))
stats_pol_ranking_101_500$Type <- "101-500"

stats_pol_ranking_501_1500 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "501-1500"), .x))
stats_pol_ranking_501_1500$Type <- "501-1500"

stats_pol_ranking_1501 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1501+"), .x))
stats_pol_ranking_1501$Type <- "1501+"

stats_pol_is_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_econ <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_econ, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_econ, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_econ, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_econ, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_econ$Type <- factor(stats_pol_reach_by_exp_econ$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_reach_by_exp_cult <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_cult, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_cult, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_cult, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_cult, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_cult$Type <- factor(stats_pol_reach_by_exp_cult$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))

stats_pol_rank <- bind_rows(
  stats_pol_ranking_1_100,
  stats_pol_ranking_101_500,
  stats_pol_ranking_501_1500,
  stats_pol_ranking_1501
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "101-500", "501-1500", "1501+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")

stats_pol_main$Label <- factor(stats_pol_main$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_econ$Label <- factor(stats_pol_reach_by_exp_econ$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_cult$Label <- factor(stats_pol_reach_by_exp_cult$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = econ_var, labels = topic_label_mapping[econ_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, 
                            stats_pol_reach_by_exp_econ %>%mutate(exp="econ"), 
                            stats_pol_reach_by_exp_cult%>%mutate(exp="cult"), 
                            stats_pol_gender, stats_pol_rank, stats_pol_US)

stats_pol_comb %<>% mutate(exp = ifelse(is.na(exp),"other", exp))
# Filter out the rows that don't meet the condition
stats_pol_comb %<>%
  filter(!(Label == "Cultural\nliberalism" & exp == "econ")) %>%
  filter(!(Label == "Economic\nCollectivism" & exp == "cult"))
stats_pol_comb %<>% select(-exp)

stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "101-500", "501-1500", "1501+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1501+", "501-1500","101-500", "1-100",  
  "Non-US", "US"
))

# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "101-500" = "#33A02C", "501-1500" = "#e31a1c", "1501+" = "#ff7f00",
  "US" = "red3", "Non-US" = "grey40"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Cultural\nliberalism","Economic\nCollectivism")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% econ_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    
    # strip.background = element_rect(fill = NA, color = NA),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
ggsave("fig3.jpg", p_all, width = 20, height = 22, dpi = 300)


```


Figure 4

```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(beh_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_cred==1), .x))
stats_pol_type_H_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_cred==1), .x))
stats_pol_type_L_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_cred==1), .x))
stats_pol_type_L_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_cred==1), .x))

stats_pol_ranking_1_100 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1-100"), .x))
stats_pol_ranking_1_100$Type <- "1-100"

stats_pol_ranking_101_500 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "101-500"), .x))
stats_pol_ranking_101_500$Type <- "101-500"

stats_pol_ranking_501_1500 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "501-1500"), .x))
stats_pol_ranking_501_1500$Type <- "501-1500"

stats_pol_ranking_1501 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1501+"), .x))
stats_pol_ranking_1501$Type <- "1501+"

stats_pol_is_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_cred <- bind_rows(
  mutate(stats_pol_type_H_reach_H_cred, Type = "High R-High C"),
  mutate(stats_pol_type_H_reach_L_cred, Type = "High R-Low C"),
  mutate(stats_pol_type_L_reach_H_cred, Type = "Low R-High C"),
  mutate(stats_pol_type_L_reach_L_cred, Type = "Low R-Low C")
)
stats_pol_reach_by_cred$Type <- factor(stats_pol_reach_by_cred$Type, levels = c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))

stats_pol_rank <- bind_rows(
  stats_pol_ranking_1_100,
  stats_pol_ranking_101_500,
  stats_pol_ranking_501_1500,
  stats_pol_ranking_1501
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "101-500", "501-1500", "1501+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")

stats_pol_main$Label <- factor(stats_pol_main$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_reach_by_cred$Label <- factor(stats_pol_reach_by_cred$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = beh_var, labels = topic_label_mapping[beh_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_cred, stats_pol_gender, stats_pol_rank, stats_pol_US)

stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C") ~ "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
  Type %in% c("1-100", "101-500", "501-1500", "1501+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
    "University\nRankings",
    "Country"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C",
  "1501+", "501-1500","101-500", "1-100",  
  "Non-US", "US"
))

# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-High C" = "#A65628", "High R-Low C" = "#F781BF",
  "Low R-High C" = "#999999", "Low R-Low C" = "gold2",
  "1-100" = "#1F78B4", "101-500" = "#33A02C", "501-1500" = "#e31a1c", "1501+" = "#ff7f00",
  "US" = "red3", "Non-US" = "grey40"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Egocentrism","Toxicity", "Emotionality/\nReasoning")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% beh_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
        strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
ggsave("fig4.jpg", p_all, width = 20, height = 22, dpi = 300)

```

# Appendix Figures



Appendix Figure 4
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(clim_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_climate==1), .x))
stats_pol_type_H_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_climate==1), .x))
stats_pol_type_L_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_climate==1), .x))
stats_pol_type_L_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_climate==1), .x))

stats_pol_ranking_1_100 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1-100"), .x))
stats_pol_ranking_1_100$Type <- "1-100"

stats_pol_ranking_101_500 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "101-500"), .x))
stats_pol_ranking_101_500$Type <- "101-500"

stats_pol_ranking_501_1500 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "501-1500"), .x))
stats_pol_ranking_501_1500$Type <- "501-1500"

stats_pol_ranking_1501 <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1501+"), .x))
stats_pol_ranking_1501$Type <- "1501+"

stats_pol_is_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_us_users <- map_df(clim_var, ~calculate_stats(users_df %>% filter(is_bot_50==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_climate <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_climate, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_climate, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_climate, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_climate, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_climate$Type <- factor(stats_pol_reach_by_exp_climate$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))

stats_pol_rank <- bind_rows(
  stats_pol_ranking_1_100,
  stats_pol_ranking_101_500,
  stats_pol_ranking_501_1500,
  stats_pol_ranking_1501
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "101-500", "501-1500", "1501+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")

stats_pol_us_users$Type <- "US users"
stats_pol_us_users$Type <- factor(stats_pol_us_users$Type, levels = "US users")

stats_pol_main$Label <- factor(stats_pol_main$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_reach_by_exp_climate$Label <- factor(stats_pol_reach_by_exp_climate$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_us_users$Label <- factor(stats_pol_us_users$Term, levels = clim_var, labels = topic_label_mapping[clim_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_exp_climate, stats_pol_gender, stats_pol_rank, stats_pol_US, stats_pol_us_users)

# Extract the US users values for each Term
us_users_values <- stats_pol_comb %>%
  filter(Type == "US users") %>%
  select(Term, Mean, StdError, CI_lower, CI_upper) %>%
  rename(US_users_Mean = Mean, US_users_StdError = StdError, US_users_CI_lower = CI_lower, US_users_CI_upper = CI_upper)

# Join the US users values with the original dataframe
stats_pol_comb <- stats_pol_comb %>%
  left_join(us_users_values, by = "Term") %>%
  mutate(
    Mean = Mean / US_users_Mean,
    StdError = StdError / US_users_StdError,
    CI_lower = CI_lower / US_users_CI_lower,
    CI_upper = CI_upper / US_users_CI_upper
  ) %>%
  select(Term, Type, Label, Mean, StdError, CI_lower, CI_upper)

stats_pol_comb %<>% filter(Type!="US users")

# stats_pol_climate
stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "101-500", "501-1500", "1501+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country",
  Type %in% c("US users") ~ "US\nGeneral\nPopulation"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country",
    "US\nGeneral\nPopulation"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1501+", "501-1500","101-500", "1-100",  
  "Non-US", "US",
  "US users"
))

# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "101-500" = "#33A02C", "501-1500" = "#e31a1c", "1501+" = "#ff7f00",
  "US" = "red3", "Non-US" = "grey40",
  "US users" = "purple3"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Climate\nAction","Techno-\nOptimism", "Behavioural\nAdjustment")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% clim_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value Relative to Average US General Population", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
ggsave("AppFig4.jpg", p_all, width = 20, height = 22, dpi = 300)

```
 
Appendix Figure 5
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(econ_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_econ==1), .x))
stats_pol_type_H_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_econ==1), .x))
stats_pol_type_L_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_econ==1), .x))
stats_pol_type_L_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_econ==1), .x))

stats_pol_type_H_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_cult==1), .x))
stats_pol_type_H_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_cult==1), .x))
stats_pol_type_L_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_cult==1), .x))
stats_pol_type_L_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_cult==1), .x))

stats_pol_ranking_1_100 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1-100"), .x))
stats_pol_ranking_1_100$Type <- "1-100"

stats_pol_ranking_101_500 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "101-500"), .x))
stats_pol_ranking_101_500$Type <- "101-500"

stats_pol_ranking_501_1500 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "501-1500"), .x))
stats_pol_ranking_501_1500$Type <- "501-1500"

stats_pol_ranking_1501 <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1501+"), .x))
stats_pol_ranking_1501$Type <- "1501+"

stats_pol_is_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_us_users <- map_df(econ_var, ~calculate_stats(users_df%>% filter(is_bot_50==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_econ <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_econ, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_econ, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_econ, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_econ, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_econ$Type <- factor(stats_pol_reach_by_exp_econ$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_reach_by_exp_cult <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_cult, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_cult, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_cult, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_cult, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_cult$Type <- factor(stats_pol_reach_by_exp_cult$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))

stats_pol_rank <- bind_rows(
  stats_pol_ranking_1_100,
  stats_pol_ranking_101_500,
  stats_pol_ranking_501_1500,
  stats_pol_ranking_1501
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "101-500", "501-1500", "1501+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")

stats_pol_us_users$Type <- "US users"
stats_pol_us_users$Type <- factor(stats_pol_us_users$Type, levels = "US users")

stats_pol_main$Label <- factor(stats_pol_main$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_econ$Label <- factor(stats_pol_reach_by_exp_econ$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_cult$Label <- factor(stats_pol_reach_by_exp_cult$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_us_users$Label <- factor(stats_pol_us_users$Term, levels = econ_var, labels = topic_label_mapping[econ_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, 
                            stats_pol_reach_by_exp_econ %>%mutate(exp="econ"), 
                            stats_pol_reach_by_exp_cult%>%mutate(exp="cult"), 
                            stats_pol_gender, stats_pol_rank, stats_pol_US,stats_pol_us_users)

stats_pol_comb %<>% mutate(exp = ifelse(is.na(exp),"other", exp))
# Filter out the rows that don't meet the condition
stats_pol_comb %<>%
  filter(!(Label == "Cultural\nliberalism" & exp == "econ")) %>%
  filter(!(Label == "Economic\nCollectivism" & exp == "cult"))
stats_pol_comb %<>% select(-exp)

# Extract the US users values for each Term
us_users_values <- stats_pol_comb %>%
  filter(Type == "US users") %>%
  select(Term, Mean, StdError, CI_lower, CI_upper) %>%
  rename(US_users_Mean = Mean, US_users_StdError = StdError, US_users_CI_lower = CI_lower, US_users_CI_upper = CI_upper)

# Join the US users values with the original dataframe
stats_pol_comb <- stats_pol_comb %>%
  left_join(us_users_values, by = "Term") %>%
  mutate(
    Mean = Mean / US_users_Mean,
    StdError = StdError / US_users_StdError,
    CI_lower = CI_lower / US_users_CI_lower,
    CI_upper = CI_upper / US_users_CI_upper
  ) %>%
  select(Term, Type, Label, Mean, StdError, CI_lower, CI_upper)

stats_pol_comb %<>% filter(Type!="US users")

stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "101-500", "501-1500", "1501+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country",
  Type %in% c("US users") ~ "US\nGeneral\nPopulation"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country",
    "Field\nMatch",
    "US\nGeneral\nPopulation"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1501+", "501-1500","101-500", "1-100",  
  "Non-US", "US",
  "Does Culture", "Does Economics", "Does Neither",
  "US users"
))

# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "101-500" = "#33A02C", "501-1500" = "#e31a1c", "1501+" = "#ff7f00",
  "US" = "red3", "Non-US" = "grey40",
  "Does Culture" = "cyan3", "Does Economics" = "orange2", "Does Neither" = "grey40",
  "US users"="purple3"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Cultural\nliberalism","Economic\nCollectivism")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% econ_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value Relative to Average US General Population", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
ggsave("AppFig5.jpg", p_all, width = 20, height = 22, dpi = 300)

```
 

Appendix Figure 6
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(beh_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_cred==1), .x))
stats_pol_type_H_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_cred==1), .x))
stats_pol_type_L_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_cred==1), .x))
stats_pol_type_L_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_cred==1), .x))

stats_pol_ranking_1_100 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1-100"), .x))
stats_pol_ranking_1_100$Type <- "1-100"

stats_pol_ranking_101_500 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "101-500"), .x))
stats_pol_ranking_101_500$Type <- "101-500"

stats_pol_ranking_501_1500 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "501-1500"), .x))
stats_pol_ranking_501_1500$Type <- "501-1500"

stats_pol_ranking_1501 <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(ranking_cat == "1501+"), .x))
stats_pol_ranking_1501$Type <- "1501+"

stats_pol_is_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_us_users <- map_df(beh_var, ~calculate_stats(users_df %>% filter(is_bot_50==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_cred <- bind_rows(
  mutate(stats_pol_type_H_reach_H_cred, Type = "High R-High C"),
  mutate(stats_pol_type_H_reach_L_cred, Type = "High R-Low C"),
  mutate(stats_pol_type_L_reach_H_cred, Type = "Low R-High C"),
  mutate(stats_pol_type_L_reach_L_cred, Type = "Low R-Low C")
)
stats_pol_reach_by_cred$Type <- factor(stats_pol_reach_by_cred$Type, levels = c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))

stats_pol_rank <- bind_rows(
  stats_pol_ranking_1_100,
  stats_pol_ranking_101_500,
  stats_pol_ranking_501_1500,
  stats_pol_ranking_1501
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "101-500", "501-1500", "1501+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")

stats_pol_us_users$Type <- "US users"
stats_pol_us_users$Type <- factor(stats_pol_us_users$Type, levels = "US users")

stats_pol_main$Label <- factor(stats_pol_main$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_reach_by_cred$Label <- factor(stats_pol_reach_by_cred$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_us_users$Label <- factor(stats_pol_us_users$Term, levels = beh_var, labels = topic_label_mapping[beh_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_cred, stats_pol_gender, stats_pol_rank, stats_pol_US, stats_pol_us_users)

# Extract the US users values for each Term
us_users_values <- stats_pol_comb %>%
  filter(Type == "US users") %>%
  select(Term, Mean, StdError, CI_lower, CI_upper) %>%
  rename(US_users_Mean = Mean, US_users_StdError = StdError, US_users_CI_lower = CI_lower, US_users_CI_upper = CI_upper)

# Join the US users values with the original dataframe
stats_pol_comb <- stats_pol_comb %>%
  left_join(us_users_values, by = "Term") %>%
  mutate(
    Mean = Mean / US_users_Mean,
    StdError = StdError / US_users_StdError,
    CI_lower = CI_lower / US_users_CI_lower,
    CI_upper = CI_upper / US_users_CI_upper
  ) %>%
  select(Term, Type, Label, Mean, StdError, CI_lower, CI_upper)

stats_pol_comb %<>% filter(Type!="US users")

stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C") ~ "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
  Type %in% c("1-100", "101-500", "501-1500", "1501+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country",
  Type %in% c("US users") ~ "US\nGeneral\nPopulation"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
    "University\nRankings",
    "Country",
    "US\nGeneral\nPopulation"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C",
  "1501+", "501-1500","101-500", "1-100",  
  "Non-US", "US",
  "US users"
))
# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-High C" = "#A65628", "High R-Low C" = "#F781BF",
  "Low R-High C" = "#999999", "Low R-Low C" = "gold2",
  "1-100" = "#1F78B4", "101-500" = "#33A02C", "501-1500" = "#e31a1c", "1501+" = "#ff7f00",
  "US" = "red3", "Non-US" = "grey40",
  "US users"="purple3"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Egocentrism","Toxicity", "Emotionality/\nReasoning")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% beh_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value Relative to Average US General Population", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
ggsave("AppFig6.jpg", p_all, width = 20, height = 22, dpi = 300)

```


# Reporting Statistical Evidence 

## Calculate the mean, standard deviation (SD), and 95% confidence intervals (CIs) for stance_cultural_liberalism and stance_econ_collectivism
```{r}
# Function to calculate mean, sd, and 95% CI
calculate_stats_base_r <- function(data, variable) {
  var_data <- data[[variable]]
  var_data <- var_data[!is.na(var_data)]
  
  mean_val <- mean(var_data)
  sd_val <- sd(var_data)
  
  # Sample size
  n <- length(var_data)
  
  # Standard error
  se_val <- sd_val / sqrt(n)
  
  # 95% confidence intervals
  error_margin <- qt(0.975, df = n - 1) * se_val
  ci_lower <- mean_val - error_margin
  ci_upper <- mean_val + error_margin
  
  list(
    mean = mean_val,
    sd = sd_val,
    ci_lower = ci_lower,
    ci_upper = ci_upper
  )
}

# Variables of interest
variables <- c("stance_climate_action", "pro_techno_prop", "pro_beh_prop")

# Calculate statistics for academics
cat("Academics:\n")
for (variable in variables) {
  stats <- calculate_stats_base_r(repl_df, variable)
  print(paste("Mean for", variable, ": ", stats$mean))
  print(paste("SD for", variable, ": ", stats$sd))
  print(paste("95% CI for", variable, ": (", stats$ci_lower, ", ", stats$ci_upper, ")"))
}


```


## Gender Differences in Techno-Optimism and Behavioral Adjustment
```{r}
# Gender Differences Statistical Tests

# Filter data for male and female academics
data_male <- repl_df %>% filter(is_male == 1)
data_female <- repl_df %>% filter(is_female == 1)

# Techno-optimism
t.test(pro_techno_prop ~ is_male, data = repl_df)
cohen.d(pro_techno_prop ~ is_male, data = repl_df)

# Behavioral Adjustment
t.test(pro_beh_prop ~ is_male, data = repl_df)
cohen.d(pro_beh_prop ~ is_male, data = repl_df)

# Climate Action
t.test(stance_climate_action ~ is_male, data = repl_df)
cohen.d(stance_climate_action ~ is_male, data = repl_df)

```

## Field differences
```{r}
# Filter data by fields
data_stem <- repl_df %>% filter(is_stem == 1)
data_soc_sci <- repl_df %>% filter(is_soc_sci == 1)
data_humanities <- repl_df %>% filter(is_humanities == 1)

# Climate Action
t.test(stance_climate_action ~ is_stem, data = repl_df)
t.test(stance_climate_action ~ is_soc_sci, data = repl_df)
t.test(stance_climate_action ~ is_humanities, data = repl_df)

# Cohen's d for effect size
cohen.d(stance_climate_action ~ is_stem, data = repl_df)
cohen.d(stance_climate_action ~ is_soc_sci, data = repl_df)
cohen.d(stance_climate_action ~ is_humanities, data = repl_df)


# Techno-optimism
t.test(pro_techno_prop ~ is_stem, data = repl_df)
t.test(pro_techno_prop ~ is_soc_sci, data = repl_df)
t.test(pro_techno_prop ~ is_humanities, data = repl_df)

# Cohen's d for effect size
cohen.d(pro_techno_prop ~ is_stem, data = repl_df)
cohen.d(pro_techno_prop ~ is_soc_sci, data = repl_df)
cohen.d(pro_techno_prop ~ is_humanities, data = repl_df)

```

## High vs Low Reach with Expertise
```{r}
t.test(stance_climate_action ~ type_H_reach_H_exp_climate, data = repl_df)
cohen.d(stance_climate_action ~ type_H_reach_H_exp_climate, data = repl_df)

t.test(stance_climate_action ~ type_H_reach_L_exp_climate, data = repl_df)
cohen.d(stance_climate_action ~ type_H_reach_L_exp_climate, data = repl_df)

t.test(stance_climate_action ~ type_L_reach_H_exp_climate, data = repl_df)
cohen.d(stance_climate_action ~ type_L_reach_H_exp_climate, data = repl_df)

t.test(stance_climate_action ~ type_L_reach_L_exp_climate, data = repl_df)
cohen.d(stance_climate_action ~ type_L_reach_L_exp_climate, data = repl_df)

```

## Climate Action Stance: University Rankings
```{r}
# Create indicator variables for university rankings
repl_df <- repl_df %>%
  mutate(is_top100 = ifelse(ranking_cat == "1-100", 1, 0),
         is_101_500 = ifelse(ranking_cat == "101-500", 1, 0),
         is_501_1500 = ifelse(ranking_cat == "501-1500", 1, 0),
         is_1501plus = ifelse(ranking_cat == "1501+", 1, 0))

# Climate Action Stance: University Rankings (Top 100)
t.test(stance_climate_action ~ is_top100, data = repl_df)
cohen.d(stance_climate_action ~ is_top100, data = repl_df)

# Climate Action Stance: University Rankings (101-500)
t.test(stance_climate_action ~ is_101_500, data = repl_df)
cohen.d(stance_climate_action ~ is_101_500, data = repl_df)

# Climate Action Stance: University Rankings (501-1500)
t.test(stance_climate_action ~ is_501_1500, data = repl_df)
cohen.d(stance_climate_action ~ is_501_1500, data = repl_df)

# Climate Action Stance: University Rankings (1501+)
t.test(stance_climate_action ~ is_1501plus, data = repl_df)
cohen.d(stance_climate_action ~ is_1501plus, data = repl_df)


```

## US-based vs Non-US-based academics
```{r}
# Climate Action Stance: US-based vs Non-US-based academics
t.test(stance_climate_action ~ is_US, data = repl_df)
cohen.d(stance_climate_action ~ is_US, data = repl_df)

# Behavioral Adjustments Stance: US-based vs Non-US-based academics
t.test(pro_beh_prop ~ is_US, data = repl_df)
cohen.d(pro_beh_prop ~ is_US, data = repl_df)

```

## Behavioral Adjustments Stance: High vs Low Reach with Expertise
```{r}
t.test(pro_beh_prop ~ type_H_reach_H_exp_climate, data = repl_df)
cohen.d(pro_beh_prop ~ type_H_reach_H_exp_climate, data = repl_df)

t.test(pro_beh_prop ~ type_H_reach_L_exp_climate, data = repl_df)
cohen.d(pro_beh_prop ~ type_H_reach_L_exp_climate, data = repl_df)

t.test(pro_beh_prop ~ type_L_reach_H_exp_climate, data = repl_df)
cohen.d(pro_beh_prop ~ type_L_reach_H_exp_climate, data = repl_df)

t.test(pro_beh_prop ~ type_L_reach_L_exp_climate, data = repl_df)
cohen.d(pro_beh_prop ~ type_L_reach_L_exp_climate, data = repl_df)

```

## Social Media Reach vs Expertise
```{r}
# High-reach non-experts (low expertise) vs high-reach experts on climate action stance
t.test(stance_climate_action ~ type_H_reach_H_exp_climate, data = repl_df %>% filter(type_H_reach_H_exp_climate == 1 | type_H_reach_L_exp_climate == 1))
cohen.d(stance_climate_action ~ type_H_reach_H_exp_climate, data = repl_df %>% filter(type_H_reach_H_exp_climate == 1 | type_H_reach_L_exp_climate == 1))

# Low-reach subject matter experts vs high-reach non-experts on climate action stance
t.test(stance_climate_action ~ type_L_reach_H_exp_climate, data = repl_df %>% filter(type_L_reach_H_exp_climate == 1 | type_H_reach_L_exp_climate == 1))
cohen.d(stance_climate_action ~ type_L_reach_H_exp_climate, data = repl_df %>% filter(type_L_reach_H_exp_climate == 1 | type_H_reach_L_exp_climate == 1))


```

## Calculate the mean, standard deviation (SD), and 95% confidence intervals (CIs) for stance_cultural_liberalism and stance_econ_collectivism
```{r}
# Function to calculate mean, sd, and 95% CI using base R
calculate_stats_base_r <- function(data, variable) {
  # Remove NA values
  var_data <- data[[variable]]
  var_data <- var_data[!is.na(var_data)]
  
  # Calculate mean and standard deviation
  mean_val <- mean(var_data)
  sd_val <- sd(var_data)
  
  # Sample size
  n <- length(var_data)
  
  # Standard error
  se_val <- sd_val / sqrt(n)
  
  # 95% confidence intervals
  error_margin <- qt(0.975, df = n - 1) * se_val
  ci_lower <- mean_val - error_margin
  ci_upper <- mean_val + error_margin
  
  # Return values as a named list
  list(
    mean = mean_val,
    sd = sd_val,
    ci_lower = ci_lower,
    ci_upper = ci_upper
  )
}

# Assuming your dataframe is called repl_df

# Calculate stats for stance_cultural_liberalism
cultural_liberalism_stats <- calculate_stats_base_r(repl_df, "stance_cultural_liberalism")
print(paste("Mean for Cultural Liberalism: ", cultural_liberalism_stats$mean))
print(paste("SD for Cultural Liberalism: ", cultural_liberalism_stats$sd))
print(paste("95% CI for Cultural Liberalism: (", cultural_liberalism_stats$ci_lower, ", ", cultural_liberalism_stats$ci_upper, ")"))

# Calculate stats for stance_econ_collectivism
econ_collectivism_stats <- calculate_stats_base_r(repl_df, "stance_econ_collectivism")
print(paste("Mean for Economic Collectivism: ", econ_collectivism_stats$mean))
print(paste("SD for Economic Collectivism: ", econ_collectivism_stats$sd))
print(paste("95% CI for Economic Collectivism: (", econ_collectivism_stats$ci_lower, ", ", econ_collectivism_stats$ci_upper, ")"))


```
## High-reach non-experts vs high-reach experts
```{r}
# Cultural Liberalism: High-reach non-experts vs high-reach experts
t.test(stance_cultural_liberalism ~ type_H_reach_H_exp_cult, data = repl_df)
cohen.d(stance_cultural_liberalism ~ type_H_reach_H_exp_cult, data = repl_df)

# Economic Collectivism: High-reach non-experts vs high-reach experts
t.test(stance_econ_collectivism ~ type_H_reach_H_exp_econ, data = repl_df)
cohen.d(stance_econ_collectivism ~ type_H_reach_H_exp_econ, data = repl_df)


# Cultural Liberalism: High-reach non-experts vs others
t.test(stance_cultural_liberalism ~ type_H_reach_L_exp_cult, data = repl_df)
cohen.d(stance_cultural_liberalism ~ type_H_reach_L_exp_cult, data = repl_df)

# Economic Collectivism: High-reach non-experts vs others
t.test(stance_econ_collectivism ~ type_H_reach_L_exp_econ, data = repl_df)
cohen.d(stance_econ_collectivism ~ type_H_reach_L_exp_econ, data = repl_df)


# Cultural Liberalism: High-reach non-experts vs high-reach experts
t.test(stance_cultural_liberalism ~ type_H_reach_H_exp_cult, data = repl_df %>% filter(type_H_reach_H_exp_cult == 1 | type_H_reach_L_exp_cult == 1))
cohen.d(stance_cultural_liberalism ~ type_H_reach_H_exp_cult, data = repl_df %>% filter(type_H_reach_H_exp_cult == 1 | type_H_reach_L_exp_cult == 1))

# Economic Collectivism: High-reach non-experts vs high-reach experts
t.test(stance_econ_collectivism ~ type_H_reach_H_exp_econ, data = repl_df %>% filter(type_H_reach_H_exp_econ == 1 | type_H_reach_L_exp_econ == 1))
cohen.d(stance_econ_collectivism ~ type_H_reach_H_exp_econ, data = repl_df %>% filter(type_H_reach_H_exp_econ == 1 | type_H_reach_L_exp_econ == 1))





```
## Gender difference on culture and economy
```{r}
# Cultural Liberalism: Gender (Male vs Female)
t.test(stance_cultural_liberalism ~ is_male, data = repl_df)
cohen.d(stance_cultural_liberalism ~ is_male, data = repl_df)

# Economic Collectivism: Gender (Male vs Female)
t.test(stance_econ_collectivism ~ is_male, data = repl_df)
cohen.d(stance_econ_collectivism ~ is_male, data = repl_df)

```

## Field differences: Social Sciences, Humanities, and STEM on cultural liberalism and economic collectivism
```{r}
# Cultural Liberalism: Social Sciences vs Others
t.test(stance_cultural_liberalism ~ is_soc_sci, data = repl_df)
cohen.d(stance_cultural_liberalism ~ is_soc_sci, data = repl_df)

# Economic Collectivism: Social Sciences vs Others
t.test(stance_econ_collectivism ~ is_soc_sci, data = repl_df)
cohen.d(stance_econ_collectivism ~ is_soc_sci, data = repl_df)

# Cultural Liberalism: Humanities vs Others
t.test(stance_cultural_liberalism ~ is_humanities, data = repl_df)
cohen.d(stance_cultural_liberalism ~ is_humanities, data = repl_df)

# Economic Collectivism: Humanities vs Others
t.test(stance_econ_collectivism ~ is_humanities, data = repl_df)
cohen.d(stance_econ_collectivism ~ is_humanities, data = repl_df)

# Cultural Liberalism: STEM vs Others
t.test(stance_cultural_liberalism ~ is_stem, data = repl_df)
cohen.d(stance_cultural_liberalism ~ is_stem, data = repl_df)

# Economic Collectivism: STEM vs Others
t.test(stance_econ_collectivism ~ is_stem, data = repl_df)
cohen.d(stance_econ_collectivism ~ is_stem, data = repl_df)

```

## University rankings and their stance on cultural liberalism and economic collectivism
```{r}
# Compare Top 100 vs 101-500
df_top100_vs_101_500 <- repl_df %>% filter(ranking_cat %in% c("1-100", "101-500"))

# Cultural Liberalism: Top 100 vs 101-500
t.test(stance_cultural_liberalism ~ ranking_cat, data = df_top100_vs_101_500)
cohen.d(stance_cultural_liberalism ~ ranking_cat, data = df_top100_vs_101_500)

# Economic Collectivism: Top 100 vs 101-500
t.test(stance_econ_collectivism ~ ranking_cat, data = df_top100_vs_101_500)
cohen.d(stance_econ_collectivism ~ ranking_cat, data = df_top100_vs_101_500)

# Compare Top 100 vs 501-1500
df_top100_vs_501_1500 <- repl_df %>% filter(ranking_cat %in% c("1-100", "501-1500"))

# Cultural Liberalism: Top 100 vs 501-1500
t.test(stance_cultural_liberalism ~ ranking_cat, data = df_top100_vs_501_1500)
cohen.d(stance_cultural_liberalism ~ ranking_cat, data = df_top100_vs_501_1500)

# Economic Collectivism: Top 100 vs 501-1500
t.test(stance_econ_collectivism ~ ranking_cat, data = df_top100_vs_501_1500)
cohen.d(stance_econ_collectivism ~ ranking_cat, data = df_top100_vs_501_1500)

# Compare Top 100 vs 1500+
df_top100_vs_1501plus <- repl_df %>% filter(ranking_cat %in% c("1-100", "1501+"))

# Cultural Liberalism: Top 100 vs 1500+
t.test(stance_cultural_liberalism ~ ranking_cat, data = df_top100_vs_1501plus)
cohen.d(stance_cultural_liberalism ~ ranking_cat, data = df_top100_vs_1501plus)

# Economic Collectivism: Top 100 vs 1500+
t.test(stance_econ_collectivism ~ ranking_cat, data = df_top100_vs_1501plus)
cohen.d(stance_econ_collectivism ~ ranking_cat, data = df_top100_vs_1501plus)

# Compare 101-500 vs 501-1500
df_101_500_vs_501_1500 <- repl_df %>% filter(ranking_cat %in% c("101-500", "501-1500"))

# Cultural Liberalism: 101-500 vs 501-1500
t.test(stance_cultural_liberalism ~ ranking_cat, data = df_101_500_vs_501_1500)
cohen.d(stance_cultural_liberalism ~ ranking_cat, data = df_101_500_vs_501_1500)

# Economic Collectivism: 101-500 vs 501-1500
t.test(stance_econ_collectivism ~ ranking_cat, data = df_101_500_vs_501_1500)
cohen.d(stance_econ_collectivism ~ ranking_cat, data = df_101_500_vs_501_1500)

# Compare 101-500 vs 1500+
df_101_500_vs_1501plus <- repl_df %>% filter(ranking_cat %in% c("101-500", "1501+"))

# Cultural Liberalism: 101-500 vs 1500+
t.test(stance_cultural_liberalism ~ ranking_cat, data = df_101_500_vs_1501plus)
cohen.d(stance_cultural_liberalism ~ ranking_cat, data = df_101_500_vs_1501plus)

# Economic Collectivism: 101-500 vs 1500+
t.test(stance_econ_collectivism ~ ranking_cat, data = df_101_500_vs_1501plus)
cohen.d(stance_econ_collectivism ~ ranking_cat, data = df_101_500_vs_1501plus)

# Compare 501-1500 vs 1500+
df_501_1500_vs_1501plus <- repl_df %>% filter(ranking_cat %in% c("501-1500", "1501+"))

# Cultural Liberalism: 501-1500 vs 1500+
t.test(stance_cultural_liberalism ~ ranking_cat, data = df_501_1500_vs_1501plus)
cohen.d(stance_cultural_liberalism ~ ranking_cat, data = df_501_1500_vs_1501plus)

# Economic Collectivism: 501-1500 vs 1500+
t.test(stance_econ_collectivism ~ ranking_cat, data = df_501_1500_vs_1501plus)
cohen.d(stance_econ_collectivism ~ ranking_cat, data = df_501_1500_vs_1501plus)

```

## Calculate the mean, standard deviation (SD), and 95% confidence intervals (CIs) for Egocentrism
```{r}
# Function to calculate mean, sd, and 95% CI using base R
calculate_stats_base_r <- function(data, variable) {
  # Remove NA values
  var_data <- data[[variable]]
  var_data <- var_data[!is.na(var_data)]
  
  # Calculate mean and standard deviation
  mean_val <- mean(var_data)
  sd_val <- sd(var_data)
  
  # Sample size
  n <- length(var_data)
  
  # Standard error
  se_val <- sd_val / sqrt(n)
  
  # 95% confidence intervals
  error_margin <- qt(0.975, df = n - 1) * se_val
  ci_lower <- mean_val - error_margin
  ci_upper <- mean_val + error_margin
  
  # Return values as a named list
  list(
    mean = mean_val,
    sd = sd_val,
    ci_lower = ci_lower,
    ci_upper = ci_upper
  )
}

# Calculate stats for egocentrism
egocentrism_stats <- calculate_stats_base_r(repl_df, "egocentrism")
print(paste("Mean for Egocentrism: ", egocentrism_stats$mean))
print(paste("SD for Egocentrism: ", egocentrism_stats$sd))
print(paste("95% CI for Egocentrism: (", egocentrism_stats$ci_lower, ", ", egocentrism_stats$ci_upper, ")"))
```

## Egocentrism: "High Reach, Low Credibility" and "Low Reach, High Credibility"

```{r}
t.test(egocentrism ~ type_H_reach_L_cred, data = repl_df)
cohen.d(egocentrism ~ type_H_reach_L_cred, data = repl_df)

t.test(egocentrism ~ type_L_reach_H_cred, data = repl_df)
cohen.d(egocentrism ~ type_L_reach_H_cred, data = repl_df)

```

## Field differences in egocentrism and toxicity between Social Sciences, Humanities, and STEM:
```{r}
# Egocentrism: Social Sciences vs Others
t.test(egocentrism ~ is_soc_sci, data = repl_df)
cohen.d(egocentrism ~ is_soc_sci, data = repl_df)

# Egocentrism: Humanities vs Others
t.test(egocentrism ~ is_humanities, data = repl_df)
cohen.d(egocentrism ~ is_humanities, data = repl_df)

# Egocentrism: STEM vs Others
t.test(egocentrism ~ is_stem, data = repl_df)
cohen.d(egocentrism ~ is_stem, data = repl_df)

# Toxicity: Social Sciences vs Others
t.test(toxicity ~ is_soc_sci, data = repl_df)
cohen.d(toxicity ~ is_soc_sci, data = repl_df)

# Toxicity: Humanities vs Others
t.test(toxicity ~ is_humanities, data = repl_df)
cohen.d(toxicity ~ is_humanities, data = repl_df)

# Toxicity: STEM vs Others
t.test(toxicity ~ is_stem, data = repl_df)
cohen.d(toxicity ~ is_stem, data = repl_df)

```


## University ranking and their stance on egocentrism and toxicity:
```{r}
# Compare Top 100 vs 101-500 for Egocentrism and Toxicity
df_top100_vs_101_500 <- repl_df %>% filter(ranking_cat %in% c("1-100", "101-500"))

# Egocentrism: Top 100 vs 101-500
t.test(egocentrism ~ ranking_cat, data = df_top100_vs_101_500)
cohen.d(egocentrism ~ ranking_cat, data = df_top100_vs_101_500)

# Toxicity: Top 100 vs 101-500
t.test(toxicity ~ ranking_cat, data = df_top100_vs_101_500)
cohen.d(toxicity ~ ranking_cat, data = df_top100_vs_101_500)

# Compare Top 100 vs 501-1500 for Egocentrism and Toxicity
df_top100_vs_501_1500 <- repl_df %>% filter(ranking_cat %in% c("1-100", "501-1500"))

# Egocentrism: Top 100 vs 501-1500
t.test(egocentrism ~ ranking_cat, data = df_top100_vs_501_1500)
cohen.d(egocentrism ~ ranking_cat, data = df_top100_vs_501_1500)

# Toxicity: Top 100 vs 501-1500
t.test(toxicity ~ ranking_cat, data = df_top100_vs_501_1500)
cohen.d(toxicity ~ ranking_cat, data = df_top100_vs_501_1500)

# Compare Top 100 vs 1500+ for Egocentrism and Toxicity
df_top100_vs_1501plus <- repl_df %>% filter(ranking_cat %in% c("1-100", "1501+"))

# Egocentrism: Top 100 vs 1500+
t.test(egocentrism ~ ranking_cat, data = df_top100_vs_1501plus)
cohen.d(egocentrism ~ ranking_cat, data = df_top100_vs_1501plus)

# Toxicity: Top 100 vs 1500+
t.test(toxicity ~ ranking_cat, data = df_top100_vs_1501plus)
cohen.d(toxicity ~ ranking_cat, data = df_top100_vs_1501plus)

```

## Egocentrism: US and non-US
```{r}
# Perform Welch's t-test for egocentrism between US-based and non-US-based scholars
t.test(egocentrism ~ is_US, data = repl_df)
# Calculate Cohen's d for the difference in egocentrism between US-based and non-US-based scholars
cohen.d(egocentrism ~ is_US, data = repl_df)

```

## Calculate Mean, SD, and 95% Confidence Intervals for Toxicity
```{r}
# Function to calculate mean, sd, and 95% CI using base R
calculate_stats_base_r <- function(data, variable) {
  var_data <- data[[variable]]
  var_data <- var_data[!is.na(var_data)]
  
  # Calculate mean and standard deviation
  mean_val <- mean(var_data)
  sd_val <- sd(var_data)
  
  # Sample size
  n <- length(var_data)
  
  # Standard error
  se_val <- sd_val / sqrt(n)
  
  # 95% confidence intervals
  error_margin <- qt(0.975, df = n - 1) * se_val
  ci_lower <- mean_val - error_margin
  ci_upper <- mean_val + error_margin
  
  # Return values as a named list
  list(
    mean = mean_val,
    sd = sd_val,
    ci_lower = ci_lower,
    ci_upper = ci_upper
  )
}

# Calculate stats for toxicity
toxicity_stats <- calculate_stats_base_r(repl_df, "toxicity")
print(paste("Mean for Toxicity: ", toxicity_stats$mean))
print(paste("SD for Toxicity: ", toxicity_stats$sd))
print(paste("95% CI for Toxicity: (", toxicity_stats$ci_lower, ", ", toxicity_stats$ci_upper, ")"))

```

## Toxicity: Field Differences (Humanities, Social Sciences, STEM)
```{r}
# Toxicity: Humanities vs Others
t.test(toxicity ~ is_humanities, data = repl_df)
cohen.d(toxicity ~ is_humanities, data = repl_df)

# Toxicity: Social Sciences vs Others
t.test(toxicity ~ is_soc_sci, data = repl_df)
cohen.d(toxicity ~ is_soc_sci, data = repl_df)

# Toxicity: STEM vs Others
t.test(toxicity ~ is_stem, data = repl_df)
cohen.d(toxicity ~ is_stem, data = repl_df)

```

## Toxicity: Twitter Reach Differences (High vs Low Twitter Reach)
```{r}
# Toxicity: High Twitter Reach (Low Credibility) vs Low Twitter Reach (High Credibility)
t.test(toxicity ~ type_H_reach_L_cred, data = repl_df)
cohen.d(toxicity ~ type_H_reach_L_cred, data = repl_df)

# Toxicity: Low Twitter Reach (High Credibility) vs High Twitter Reach (Low Credibility)
t.test(toxicity ~ type_L_reach_H_cred, data = repl_df)
cohen.d(toxicity ~ type_L_reach_H_cred, data = repl_df)

```

## Toxicity: University Ranking Differences
```{r}
# Compare Top 100 vs 101-500 for Toxicity
df_top100_vs_101_500 <- repl_df %>% filter(ranking_cat %in% c("1-100", "101-500"))

# Toxicity: Top 100 vs 101-500
t.test(toxicity ~ ranking_cat, data = df_top100_vs_101_500)
cohen.d(toxicity ~ ranking_cat, data = df_top100_vs_101_500)

# Compare Top 100 vs 501-1500 for Toxicity
df_top100_vs_501_1500 <- repl_df %>% filter(ranking_cat %in% c("1-100", "501-1500"))

# Toxicity: Top 100 vs 501-1500
t.test(toxicity ~ ranking_cat, data = df_top100_vs_501_1500)
cohen.d(toxicity ~ ranking_cat, data = df_top100_vs_501_1500)

# Compare Top 100 vs 1500+ for Toxicity
df_top100_vs_1501plus <- repl_df %>% filter(ranking_cat %in% c("1-100", "1501+"))

# Toxicity: Top 100 vs 1500+
t.test(toxicity ~ ranking_cat, data = df_top100_vs_1501plus)
cohen.d(toxicity ~ ranking_cat, data = df_top100_vs_1501plus)

```

## Toxicity: US-based vs Non-US-based Scholars
```{r}
# Perform Welch's t-test for toxicity between US-based and non-US-based scholars
t.test(toxicity ~ is_US, data = repl_df)

# Calculate Cohen's d for the difference in toxicity between US-based and non-US-based scholars
cohen.d(toxicity ~ is_US, data = repl_df)
```

## Calculate Mean, SD, and 95% Confidence Intervals for emotionality
```{r}
# Function to calculate mean, sd, and 95% CI for emotionality
calculate_stats_base_r <- function(data, variable) {
  var_data <- data[[variable]]
  var_data <- var_data[!is.na(var_data)]
  mean_val <- mean(var_data)
  sd_val <- sd(var_data)
  n <- length(var_data)
  se_val <- sd_val / sqrt(n)
  error_margin <- qt(0.975, df = n - 1) * se_val
  ci_lower <- mean_val - error_margin
  ci_upper <- mean_val + error_margin
  
  list(
    mean = mean_val,
    sd = sd_val,
    ci_lower = ci_lower,
    ci_upper = ci_upper
  )
}

# Calculate stats for emotionality
emotionality_stats <- calculate_stats_base_r(repl_df, "emotionality")
print(paste("Mean for Emotionality: ", emotionality_stats$mean))
print(paste("SD for Emotionality: ", emotionality_stats$sd))
print(paste("95% CI for Emotionality: (", emotionality_stats$ci_lower, ", ", emotionality_stats$ci_upper, ")"))
```

## Gender difference in emotionality (Female vs Male)
```{r}
t.test(emotionality ~ is_female, data = repl_df)
cohen.d(emotionality ~ is_female, data = repl_df)
```

## Field difference in emotionality
```{r}
# Emotionality: STEM vs others
t.test(emotionality ~ is_stem, data = repl_df)
cohen.d(emotionality ~ is_stem, data = repl_df)

# Emotionality: Social Sciences vs others
t.test(emotionality ~ is_soc_sci, data = repl_df)
cohen.d(emotionality ~ is_soc_sci, data = repl_df)

# Emotionality: Humanities vs others
t.test(emotionality ~ is_humanities, data = repl_df)
cohen.d(emotionality ~ is_humanities, data = repl_df)
```

## Emotionality: High Twitter Reach, Low Credibility vs Low Twitter Reach, High Credibility
```{r}
t.test(emotionality ~ type_H_reach_L_cred, data = repl_df)
cohen.d(emotionality ~ type_H_reach_L_cred, data = repl_df)

t.test(emotionality ~ type_L_reach_H_cred, data = repl_df)
cohen.d(emotionality ~ type_L_reach_H_cred, data = repl_df)
```

## Emotionality: US-based vs non-US based academics
```{r}
t.test(emotionality ~ is_US, data = repl_df)
cohen.d(emotionality ~ is_US, data = repl_df)

```

## Emotionality: High-reach, low-credibility US-based vs non-US-based
```{r}
df_HR_LC_US_vs_nonUS <- repl_df %>% filter(type_H_reach_L_cred == 1)
t.test(emotionality ~ is_US, data = df_HR_LC_US_vs_nonUS)
cohen.d(emotionality ~ is_US, data = df_HR_LC_US_vs_nonUS)

```

# Correlations between What and How of Expression

```{r}
# Function to calculate correlation, p-value, and 95% CI manually
calc_corr_stats_base <- function(var1, var2, data) {
  # Remove NA values
  data_clean <- na.omit(data[, c(var1, var2)])
  
  # Calculate correlation
  corr_value <- cor(data_clean[[var1]], data_clean[[var2]])
  
  # Calculate p-value
  cor_test <- cor.test(data_clean[[var1]], data_clean[[var2]])
  p_value <- cor_test$p.value
  
  # Sample size
  n <- nrow(data_clean)
  
  # Calculate confidence intervals for correlation
  z_corr <- 0.5 * log((1 + corr_value) / (1 - corr_value))  # Fisher transformation
  se_z <- 1 / sqrt(n - 3)
  
  z_ci_lower <- z_corr - 1.96 * se_z
  z_ci_upper <- z_corr + 1.96 * se_z
  
  # Transform back to correlation scale
  ci_lower <- (exp(2 * z_ci_lower) - 1) / (exp(2 * z_ci_lower) + 1)
  ci_upper <- (exp(2 * z_ci_upper) - 1) / (exp(2 * z_ci_upper) + 1)
  
  return(list(corr = round(corr_value, 4), p_value = round(p_value, 4), ci_lower = round(ci_lower, 4), ci_upper = round(ci_upper, 4)))
}

# Define stance and "how" variables
stance_vars_clean <- c("stance_climate_action", "pro_techno_prop", "pro_beh_prop", "stance_cultural_liberalism", "stance_econ_collectivism")

how_vars_clean <- c("Emotionality", "Egocentrism", "Toxicity")

# Initialize lists to store results
corr_results <- list()

# Loop through each stance and calculate stats for emotionality, egocentrism, and toxicity
for (stance in stance_vars_clean) {
  emotionality_stats <- calc_corr_stats_base("emotionality", stance, repl_df)
  egocentrism_stats <- calc_corr_stats_base("egocentrism", stance, repl_df)
  toxicity_stats <- calc_corr_stats_base("toxicity", stance, repl_df)
  
  # Store the results in a data frame for each stance
  corr_results[[stance]] <- data.frame(
    Variable = c("Emotionality", "Egocentrism", "Toxicity"),
    Correlation = c(emotionality_stats$corr, egocentrism_stats$corr, toxicity_stats$corr),
    `p-value` = c(emotionality_stats$p_value, egocentrism_stats$p_value, toxicity_stats$p_value),
    `95% CI Lower` = c(emotionality_stats$ci_lower, egocentrism_stats$ci_lower, toxicity_stats$ci_lower),
    `95% CI Upper` = c(emotionality_stats$ci_upper, egocentrism_stats$ci_upper, toxicity_stats$ci_upper)
  )
}

# Combine results into a single data frame
final_corr_results <- do.call(rbind, lapply(names(corr_results), function(stance) {
  result <- corr_results[[stance]]
  result$Stance <- stance
  return(result)
}))

# View final results
print(final_corr_results)


```

# Controlling for How when Evaluating What

Figures
```{r}
# Define stance variables
stance_vars <- c("stance_climate_action", "pro_techno_prop", "pro_beh_prop", "stance_cultural_liberalism", "stance_econ_collectivism")

# Convert `ranking_cat` and `is_US` into separate dummy variables
repl_df <- repl_df %>%
  mutate(
    is_US = ifelse(is_US == 1, 1, 0),  # Binary variable for US
    is_non_US = 1 - is_US,             # Binary variable for non-US
    ranking_1_100 = ifelse(ranking_cat == "1-100", 1, 0),
    ranking_101_500 = ifelse(ranking_cat == "101-500", 1, 0),
    ranking_501_1500 = ifelse(ranking_cat == "501-1500", 1, 0),
    ranking_1501 = ifelse(ranking_cat == "1501+", 1, 0)
  )

# List of groups to compare (gender, field, ranking, country)
group_vars <- c("is_female", "is_male", "is_stem", "is_soc_sci", "is_humanities", "ranking_1_100", "ranking_101_500", "ranking_501_1500", "ranking_1501", "is_US", "is_non_US")

# Create a function to run regression for each stance controlling for a specified confounder
run_regressions <- function(confounder) {
  regression_results <- list()
  for (stance in stance_vars) {
    for (group in group_vars) {
      formula <- as.formula(paste(stance, "~", group, "+", confounder))
      regression_results[[paste(stance, group, sep = "_")]] <- summary(lm(formula, data = repl_df))
    }
  }
  return(regression_results)
}

# Run regressions for each confounder
regression_results_emotionality <- run_regressions("emotionality")
regression_results_egocentrism <- run_regressions("egocentrism")
regression_results_toxicity <- run_regressions("toxicity")

# Function to extract regression coefficients and confidence intervals
extract_coefs <- function(regression_results, confounder) {
  regression_results %>%
    lapply(tidy) %>%
    bind_rows(.id = "model") %>%
    filter(term != "(Intercept)") %>%
    mutate(
      CI_lower = estimate - 1.96 * std.error,
      CI_upper = estimate + 1.96 * std.error,
      confounder = confounder
    ) %>%
    mutate(
      stance = str_extract(model, "^.*?(?=_is_|_ranking_)"),  # Extract stance
      group_var = term,  # Use term to directly get group_var
      stance = case_when(
        stance == "stance_climate_action" ~ "Climate Action",
        stance == "pro_techno_prop" ~ "Techno-Optimism",
        stance == "pro_beh_prop" ~ "Behavioural Adjustment",
        stance == "stance_cultural_liberalism" ~ "Cultural Liberalism",
        stance == "stance_econ_collectivism" ~ "Economic Collectivism"
      ),
      group_var = case_when(
        group_var == "is_female" ~ "Female",
        group_var == "is_male" ~ "Male",
        group_var == "is_stem" ~ "STEM",
        group_var == "is_soc_sci" ~ "Soc. Sciences",
        group_var == "is_humanities" ~ "Humanities",
        group_var == "ranking_1_100" ~ "1-100",
        group_var == "ranking_101_500" ~ "101-500",
        group_var == "ranking_501_1500" ~ "501-1500",
        group_var == "ranking_1501" ~ "1501+",
        group_var == "is_US" ~ "US",
        group_var == "is_non_US" ~ "Non-US",
        TRUE ~ group_var
      )
    )
}

# Extract coefficients for all three regressions
coefficients_emotionality <- extract_coefs(regression_results_emotionality, "Emotionality")
coefficients_egocentrism <- extract_coefs(regression_results_egocentrism, "Egocentrism")
coefficients_toxicity <- extract_coefs(regression_results_toxicity, "Toxicity")

# Combine all into one dataframe
coefficients_combined <- bind_rows(coefficients_emotionality, coefficients_egocentrism, coefficients_toxicity)

# Remove emotionality, egocentrism, and toxicity as grey variables, keeping only the main coefficient
coefficients_combined <- coefficients_combined %>% filter(!grepl("emotionality|egocentrism|toxicity", term))

# Set factors for correct ordering
coefficients_combined$group_var <- factor(coefficients_combined$group_var, 
                                          levels = rev(c("Male","Female",  "Humanities", "Soc. Sciences",  "STEM", 
                                                     "1-100", "101-500", "501-1500", "1501+", "US", "Non-US")))

coefficients_combined$stance <- factor(coefficients_combined$stance, 
                                       levels = c("Climate Action", "Techno-Optimism", "Behavioural Adjustment", 
                                                  "Cultural Liberalism", "Economic Collectivism"))

# Add color palette for groups
color_values <- c(
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "1-100" = "#1F78B4", "101-500" = "#33A02C", "501-1500" = "#e31a1c", "1501+" = "#ff7f00",
  "US" = "red3", "Non-US" = "grey40"
)

# Add shape values for each confounder
shape_values <- c("Emotionality" = 16, "Egocentrism" = 17, "Toxicity" = 18)  # Different shapes for different confounders

econ_coefficients <- coefficients_combined %>% filter(stance %in% c("Cultural Liberalism", "Economic Collectivism"))
climate_coefficients <- coefficients_combined %>% filter(stance %in% c("Climate Action", "Techno-Optimism", "Behavioural Adjustment"))

# Create the coefficient plot with all three regressions' coefficients for economic stances
p_econ <- ggplot(econ_coefficients, aes(x = estimate, y = group_var, color = group_var, shape = confounder)) +
  geom_point(size = 8, position = position_dodge(width = 0.5)) +  # Adjust position to separate points
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2, position = position_dodge(width = 0.5)) +
  facet_wrap(~ stance, scales = "free_x") + 
  theme_classic(base_size = 33) +
  scale_color_manual(values = color_values, guide = FALSE) +  # Remove group_var legend
  scale_shape_manual(values = shape_values) +  # Use different shapes for confounders
  labs(title = "Group Comparisons of Stances Controlling for Different Variables", 
       x = "Coefficient (Effect Size)", y = NULL) +  # Remove y-axis title
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),  # Remove title
    axis.text.x = element_text(angle = 90, hjust = 1),
    axis.text.y = element_text(color="grey30", size=30),  # Ensure consistent y-axis text styling
    strip.text = element_text(face = "bold", size = 32),  # Adjust strip text size for facets
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines"),  # Adjust spacing between columns
    legend.position = "bottom",  # Move the legend to the bottom
    legend.title = element_blank()  # Remove the legend title
  )

# Create the coefficient plot with all three regressions' coefficients for climate stances
p_climate <- ggplot(climate_coefficients, aes(x = estimate, y = group_var, color = group_var, shape = confounder)) +
  geom_point(size = 8, position = position_dodge(width = 0.5)) +  # Adjust position to separate points
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2, position = position_dodge(width = 0.5)) +
  facet_wrap(~ stance, scales = "free_x") + 
  theme_classic(base_size = 33) +
  scale_color_manual(values = color_values, guide = FALSE) +  # Remove group_var legend
  scale_shape_manual(values = shape_values) +  # Use different shapes for confounders
  labs(title = "Group Comparisons of Stances Controlling for Different Variables", 
       x = "Coefficient (Effect Size)", y = NULL) +  # Remove y-axis title
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),  # Remove title
    axis.text.x = element_text(angle = 90, hjust = 1),
    axis.text.y = element_text(color="grey30", size=30),  # Ensure consistent y-axis text styling
    strip.text = element_text(face = "bold", size = 32),  # Adjust strip text size for facets
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines"),  # Adjust spacing between columns
    legend.position = "bottom",  # Move the legend to the bottom
    legend.title = element_blank()  # Remove the legend title
  )


ggsave("climate_stances_by_group.jpg", p_climate, width = 20, height = 22, dpi = 300)
ggsave("econ_stances_by_group.jpg", p_econ, width = 20, height = 22, dpi = 300)

```

Table and Statistical Evidence
```{r}
# Define stance variables and group variables
stance_vars <- c("stance_climate_action", "pro_techno_prop", "pro_beh_prop", "stance_cultural_liberalism", "stance_econ_collectivism")
group_vars <- c("is_female", "is_male", "is_stem", "is_soc_sci", "is_humanities", "ranking_1_100", "ranking_101_500", "ranking_501_1500", "ranking_1501", "is_US", "is_non_US")

# Function to run regression and extract statistical details
run_regression_and_extract <- function(df, stance_var, group_var, confounder) {
  formula <- as.formula(paste(stance_var, "~", group_var, "+", confounder))
  model <- lm(formula, data = df)
  
  # Extract coefficients and confidence intervals
  model_summary <- tidy(model) %>%
    filter(term == group_var) %>%
    mutate(
      CI_lower = estimate - 1.96 * std.error,
      CI_upper = estimate + 1.96 * std.error,
      p_value = format.pval(p.value, digits = 4)
    ) %>%
    select(estimate, std.error, CI_lower, CI_upper, p_value)
  
  return(model_summary)
}

# Run regressions for all combinations of stances, group variables, and confounders
run_all_regressions <- function(df, stance_vars, group_vars, confounders) {
  results <- list()
  
  for (stance in stance_vars) {
    for (group in group_vars) {
      for (confounder in confounders) {
        result <- run_regression_and_extract(df, stance, group, confounder)
        result <- result %>%
          mutate(stance = stance, group_var = group, confounder = confounder)
        results[[paste(stance, group, confounder, sep = "_")]] <- result
      }
    }
  }
  
  # Combine all results into a single data frame
  combined_results <- bind_rows(results)
  return(combined_results)
}

# List of confounders (expression styles)
confounders <- c("emotionality", "egocentrism", "toxicity")

# Run all regressions and get combined results
regression_results <- run_all_regressions(repl_df, stance_vars, group_vars, confounders)

# Print the regression results
print(regression_results)

# Save the results to CSV or output for LaTeX use
write.csv(regression_results, "regression_results_controlling_expression_stance.csv", row.names = FALSE)


```

