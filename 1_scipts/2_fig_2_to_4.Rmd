---
title: "2_fig_2_to_4"
author: "Prashant Garg"
date: "2024-06-07"
output: html_document
---
# Goal: create Figures 2 to 4, and Appendix Figures A4 to A6

----------------------------------------------------------------------


# Layperson Explanation:
Load Data: The script starts by loading datasets from CSV files into dataframes.
Prepare Variables and Names: It defines lists and mappings for variables and their labels.
Function to Calculate Statistics: A function is defined to calculate mean, standard error, and confidence intervals.
Main Figures: The script calculates statistics and creates plots for different groups of variables (climate, economic, behavioral). Each figure involves similar steps: calculating stats for different subgroups, labeling variables, and plotting data.
Appendix Figures: Similar to the main figures, but with additional normalization relative to the US general population.
Save Plots: Optionally save the plots as high-resolution images.

-----------------------------------------------------------------------

# Pseudocode:

# Load Data
LOAD datasets 'repl_df.csv' and 'users_df.csv' into dataframes 'repl_df' and 'users_df'

# Prepare Variables and Names
DEFINE variable list 'variables' for analysis
DEFINE mapping 'topic_label_mapping' for variable labels

DEFINE groups of variables 'clim_var', 'econ_var', 'beh_var' for different analysis sections

# Function to Calculate Statistics
DEFINE function 'calculate_stats' to calculate mean, standard error, and confidence intervals for a given data column

# Main Figures

## Figure 2: Climate Variables
FOR each variable in 'clim_var'
    CALCULATE stats for the whole dataset, females, males, STEM, social sciences, humanities
    CALCULATE stats for high and low reach and expertise in climate, top and non-top 100 universities, US and non-US
    CALCULATE stats for climate experts and non-experts
    COMBINE results into dataframes for field, reach by expertise, gender, rank, and country groups

    LABEL variables and ensure correct factor levels
    ADD main mean for each label
    PLOT data with ggplot, including points and error bars, faceted by group and label

## Figure 3: Economic Variables
FOR each variable in 'econ_var'
    REPEAT the above steps for calculating stats and plotting
    CALCULATE stats for high and low reach and expertise in economy and culture

## Figure 4: Behavioral Variables
FOR each variable in 'beh_var'
    REPEAT the above steps for calculating stats and plotting
    CALCULATE stats for high and low reach and credibility

# Appendix Figures

## Appendix Figure 4: Climate Variables
FOR each variable in 'clim_var'
    CALCULATE stats as for Figure 2
    CALCULATE stats for US users
    NORMALIZE values relative to US general population
    PLOT data with ggplot, faceted by group and label

## Appendix Figure 5: Economic Variables
FOR each variable in 'econ_var'
    CALCULATE stats as for Figure 3
    CALCULATE stats for US users
    NORMALIZE values relative to US general population
    PLOT data with ggplot, faceted by group and label

## Appendix Figure 6: Behavioral Variables
FOR each variable in 'beh_var'
    CALCULATE stats as for Figure 4
    CALCULATE stats for US users
    NORMALIZE values relative to US general population
    PLOT data with ggplot, faceted by group and label

# Save Plots
OPTIONALLY save each plot as a high-resolution image file

----------------------------------------------------------------------



# data
```{r}
repl_df <- read_csv( "../2_data/repl_df.csv")
users_df <- read_csv( "../2_data/users_df.csv")
```



# prep
variables and names
```{r}
variables <- c("egocentrism", "toxicity", "emotionality", "stance_climate_action", "pro_techno_prop", "pro_beh_prop",  "stance_econ_collectivism", "stance_cultural_liberalism") 

topic_label_mapping <- c(
  "egocentrism" = "Egocentrism",
  "toxicity" = "Toxicity",
  "emotionality" = "Emotionality/\nReasoning",
  "stance_climate_action" = "Climate\nAction",
  "pro_techno_prop" = "Techno-\nOptimism",
  "pro_beh_prop" = "Behavioural\nAdjustment",
  "stance_econ_collectivism" = "Economic\nCollectivism",
  "stance_cultural_liberalism" = "Cultural\nliberalism"
)

clim_var <- c("pro_techno_prop", "pro_beh_prop", "stance_climate_action")
econ_var <- c("stance_cultural_liberalism",  "stance_econ_collectivism")
beh_var <- c("emotionality", "toxicity",  "egocentrism")
```

function to calc
```{r}
# Function to calculate mean, standard error, and confidence intervals for given data column
calculate_stats <- function(data, var_name) {
  var_data <- na.omit(data[[var_name]])  # Remove NA values
  n <- length(var_data)
  mean_val <- mean(var_data)
  std_error <- sd(var_data) / sqrt(n)
  z <- qnorm(0.975)  # 95% CI
  ci_lower <- mean_val - z * std_error
  ci_upper <- mean_val + z * std_error
  
  data.frame(
    Term = var_name,
    Mean = mean_val,
    StdError = std_error,
    CI_lower = ci_lower,
    CI_upper = ci_upper
  )
}
```

# Main Figures
Figure 2
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(clim_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_climate==1), .x))
stats_pol_type_H_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_climate==1), .x))
stats_pol_type_L_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_climate==1), .x))
stats_pol_type_L_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_climate==1), .x))

stats_pol_is_in_top_100_uni <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==1), .x))
stats_pol_is_in_top_100_uni_not <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==0), .x))

stats_pol_is_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))


stats_pol_is_climate_expert <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_climate_expert==1), .x))
stats_pol_does_do_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_climate_expert==0), .x))


stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_climate <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_climate, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_climate, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_climate, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_climate, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_climate$Type <- factor(stats_pol_reach_by_exp_climate$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))


stats_pol_rank <- bind_rows(
  mutate(stats_pol_is_in_top_100_uni, Type = "1-100"),
  mutate(stats_pol_is_in_top_100_uni_not, Type = "100+"),
  # mutate(stats_pol_r_1_50, Type = "1-50"),
  # mutate(stats_pol_r_r_51_100, Type = "51-100"),
  # mutate(stats_pol_r_r_101_500, Type = "101-500"),
  # mutate(stats_pol_r_500, Type = "500+")
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "100+"))
# stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-50", "51-100", "101-500", "500+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")


stats_pol_main$Label <- factor(stats_pol_main$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_reach_by_exp_climate$Label <- factor(stats_pol_reach_by_exp_climate$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = clim_var, labels = topic_label_mapping[clim_var])


stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_exp_climate, stats_pol_gender, stats_pol_rank, stats_pol_US)


stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "100+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1-100", "100+",
  "US", "Non-US"
))


# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "100+" = "#33A02C",
  "US" = "red3", "Non-US" = "grey40"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Climate\nAction","Techno-\nOptimism", "Behavioural\nAdjustment")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% clim_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    
    # strip.background = element_rect(fill = NA, color = NA),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)

# optionally, save the plot to view it clearly as it appears in the paper
# ggsave("fig2.jpg", p_all, width = 20, height = 22, dpi = 300)
```

Figure 3
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(econ_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_econ==1), .x))
stats_pol_type_H_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_econ==1), .x))
stats_pol_type_L_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_econ==1), .x))
stats_pol_type_L_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_econ==1), .x))


stats_pol_type_H_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_cult==1), .x))
stats_pol_type_H_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_cult==1), .x))
stats_pol_type_L_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_cult==1), .x))
stats_pol_type_L_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_cult==1), .x))



stats_pol_is_in_top_100_uni <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==1), .x))
stats_pol_is_in_top_100_uni_not <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==0), .x))


stats_pol_is_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_econ <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_econ, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_econ, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_econ, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_econ, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_econ$Type <- factor(stats_pol_reach_by_exp_econ$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_reach_by_exp_cult <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_cult, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_cult, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_cult, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_cult, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_cult$Type <- factor(stats_pol_reach_by_exp_cult$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))


stats_pol_rank <- bind_rows(
  mutate(stats_pol_is_in_top_100_uni, Type = "1-100"),
  mutate(stats_pol_is_in_top_100_uni_not, Type = "100+"),
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "100+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")


stats_pol_main$Label <- factor(stats_pol_main$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_econ$Label <- factor(stats_pol_reach_by_exp_econ$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_cult$Label <- factor(stats_pol_reach_by_exp_cult$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = econ_var, labels = topic_label_mapping[econ_var])


stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, 
                            stats_pol_reach_by_exp_econ %>%mutate(exp="econ"), 
                            stats_pol_reach_by_exp_cult%>%mutate(exp="cult"), 
                            stats_pol_gender, stats_pol_rank, stats_pol_US)

stats_pol_comb %<>% mutate(exp = ifelse(is.na(exp),"other", exp))
# Filter out the rows that don't meet the condition
stats_pol_comb %<>%
  filter(!(Label == "Cultural\nliberalism" & exp == "econ")) %>%
  filter(!(Label == "Economic\nCollectivism" & exp == "cult"))
stats_pol_comb %<>% select(-exp)

stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "100+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country",
    "Field\nMatch"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1-100", "100+",
  "US", "Non-US",
  "Does Culture", "Does Economics", "Does Neither"
))


# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "100+" = "#33A02C",
  "US" = "red3", "Non-US" = "grey40",
  "Does Culture" = "cyan3", "Does Economics" = "orange2", "Does Neither" = "grey40"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Cultural\nliberalism","Economic\nCollectivism")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% econ_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    
    # strip.background = element_rect(fill = NA, color = NA),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
# ggsave("fig3.jpg", p_all, width = 20, height = 22, dpi = 300)

```


Figure 4
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(beh_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_cred==1), .x))
stats_pol_type_H_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_cred==1), .x))
stats_pol_type_L_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_cred==1), .x))
stats_pol_type_L_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_cred==1), .x))

stats_pol_is_in_top_100_uni <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==1), .x))
stats_pol_is_in_top_100_uni_not <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==0), .x))

stats_pol_is_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_cred <- bind_rows(
  mutate(stats_pol_type_H_reach_H_cred, Type = "High R-High C"),
  mutate(stats_pol_type_H_reach_L_cred, Type = "High R-Low C"),
  mutate(stats_pol_type_L_reach_H_cred, Type = "Low R-High C"),
  mutate(stats_pol_type_L_reach_L_cred, Type = "Low R-Low C")
)
stats_pol_reach_by_cred$Type <- factor(stats_pol_reach_by_cred$Type, levels = c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))


stats_pol_rank <- bind_rows(
  mutate(stats_pol_is_in_top_100_uni, Type = "1-100"),
  mutate(stats_pol_is_in_top_100_uni_not, Type = "100+")
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "100+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")


stats_pol_main$Label <- factor(stats_pol_main$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_reach_by_cred$Label <- factor(stats_pol_reach_by_cred$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = beh_var, labels = topic_label_mapping[beh_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_cred, stats_pol_gender, stats_pol_rank, stats_pol_US)


stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C") ~ "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
  Type %in% c("1-100", "100+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
    "University\nRankings",
    "Country"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C",
  "1-100", "100+",
  "US", "Non-US"
))

# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-High C" = "#A65628", "High R-Low C" = "#F781BF",
  "Low R-High C" = "#999999", "Low R-Low C" = "gold2",
  "1-100" = "#1F78B4", "100+" = "#33A02C",
  "US" = "red3", "Non-US" = "grey40"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Egocentrism","Toxicity", "Emotionality/\nReasoning")
)


# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% beh_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
        strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
# ggsave("fig4.jpg", p_all, width = 20, height = 22, dpi = 300)

```

# Appendix Figures



Appendix Figure 4
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(clim_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_climate==1), .x))
stats_pol_type_H_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_climate==1), .x))
stats_pol_type_L_reach_H_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_climate==1), .x))
stats_pol_type_L_reach_L_exp_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_climate==1), .x))

stats_pol_is_in_top_100_uni <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==1), .x))
stats_pol_is_in_top_100_uni_not <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==0), .x))

stats_pol_is_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))


stats_pol_is_climate_expert <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_climate_expert==1), .x))
stats_pol_does_do_climate <- map_df(clim_var, ~calculate_stats(repl_df %>% filter(is_climate_expert==0), .x))

stats_pol_us_users <- map_df(clim_var, ~calculate_stats(users_df %>% filter(is_bot_50==0), .x))


stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_climate <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_climate, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_climate, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_climate, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_climate, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_climate$Type <- factor(stats_pol_reach_by_exp_climate$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))

stats_pol_rank <- bind_rows(
  mutate(stats_pol_is_in_top_100_uni, Type = "1-100"),
  mutate(stats_pol_is_in_top_100_uni_not, Type = "100+")
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "100+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")

stats_pol_us_users$Type <- "US users"
stats_pol_us_users$Type <- factor(stats_pol_us_users$Type, levels = "US users")


stats_pol_main$Label <- factor(stats_pol_main$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_reach_by_exp_climate$Label <- factor(stats_pol_reach_by_exp_climate$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = clim_var, labels = topic_label_mapping[clim_var])
stats_pol_us_users$Label <- factor(stats_pol_us_users$Term, levels = clim_var, labels = topic_label_mapping[clim_var])

stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_exp_climate, stats_pol_gender, stats_pol_rank, stats_pol_US, stats_pol_us_users)

# Extract the US users values for each Term
us_users_values <- stats_pol_comb %>%
  filter(Type == "US users") %>%
  select(Term, Mean, StdError, CI_lower, CI_upper) %>%
  rename(US_users_Mean = Mean, US_users_StdError = StdError, US_users_CI_lower = CI_lower, US_users_CI_upper = CI_upper)

# Join the US users values with the original dataframe
stats_pol_comb <- stats_pol_comb %>%
  left_join(us_users_values, by = "Term") %>%
  mutate(
    Mean = Mean / US_users_Mean,
    StdError = StdError / US_users_StdError,
    CI_lower = CI_lower / US_users_CI_lower,
    CI_upper = CI_upper / US_users_CI_upper
  ) %>%
  select(Term, Type, Label, Mean, StdError, CI_lower, CI_upper)

stats_pol_comb %<>% filter(Type!="US users")

# stats_pol_climate
stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "100+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country",
  Type %in% c("US users") ~ "US\nGeneral\nPopulation"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country",
    "US\nGeneral\nPopulation"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1-100", "100+",
  "US", "Non-US",
  "US users"
))


# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "100+" = "#33A02C",
  "US" = "red3", "Non-US" = "grey40",
  "US users" = "purple3"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Climate\nAction","Techno-\nOptimism", "Behavioural\nAdjustment")
)


# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% clim_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value Relative to Average US General Population", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    
    # strip.background = element_rect(fill = NA, color = NA),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  # geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = 0.5, ymax = 0.6), fill = "gray90", inherit.aes = FALSE) +
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
# ggsave("AppFig4.jpg", p_all, width = 20, height = 22, dpi = 300)
```

Appendix Figure 5
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(econ_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_econ==1), .x))
stats_pol_type_H_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_econ==1), .x))
stats_pol_type_L_reach_H_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_econ==1), .x))
stats_pol_type_L_reach_L_exp_econ <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_econ==1), .x))


stats_pol_type_H_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_exp_cult==1), .x))
stats_pol_type_H_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_exp_cult==1), .x))
stats_pol_type_L_reach_H_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_exp_cult==1), .x))
stats_pol_type_L_reach_L_exp_cult <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_exp_cult==1), .x))


stats_pol_is_in_top_100_uni <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==1), .x))
stats_pol_is_in_top_100_uni_not <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==0), .x))

stats_pol_is_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(econ_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_us_users <- map_df(econ_var, ~calculate_stats(users_df%>% filter(is_bot_50==0), .x))

stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_exp_econ <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_econ, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_econ, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_econ, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_econ, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_econ$Type <- factor(stats_pol_reach_by_exp_econ$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_reach_by_exp_cult <- bind_rows(
  mutate(stats_pol_type_H_reach_H_exp_cult, Type = "High R-E"),
  mutate(stats_pol_type_H_reach_L_exp_cult, Type = "High R-Not E"),
  mutate(stats_pol_type_L_reach_H_exp_cult, Type = "Low R-E"),
  mutate(stats_pol_type_L_reach_L_exp_cult, Type = "Low R-Not E")
)
stats_pol_reach_by_exp_cult$Type <- factor(stats_pol_reach_by_exp_cult$Type, levels = c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))


stats_pol_rank <- bind_rows(
  mutate(stats_pol_is_in_top_100_uni, Type = "1-100"),
  mutate(stats_pol_is_in_top_100_uni_not, Type = "100+")
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "100+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")


stats_pol_us_users$Type <- "US users"
stats_pol_us_users$Type <- factor(stats_pol_us_users$Type, levels = "US users")


stats_pol_main$Label <- factor(stats_pol_main$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_econ$Label <- factor(stats_pol_reach_by_exp_econ$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_reach_by_exp_cult$Label <- factor(stats_pol_reach_by_exp_cult$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = econ_var, labels = topic_label_mapping[econ_var])
stats_pol_us_users$Label <- factor(stats_pol_us_users$Term, levels = econ_var, labels = topic_label_mapping[econ_var])


stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, 
                            stats_pol_reach_by_exp_econ %>%mutate(exp="econ"), 
                            stats_pol_reach_by_exp_cult%>%mutate(exp="cult"), 
                            stats_pol_gender, stats_pol_rank, stats_pol_US,stats_pol_us_users)

stats_pol_comb %<>% mutate(exp = ifelse(is.na(exp),"other", exp))
# Filter out the rows that don't meet the condition
stats_pol_comb %<>%
  filter(!(Label == "Cultural\nliberalism" & exp == "econ")) %>%
  filter(!(Label == "Economic\nCollectivism" & exp == "cult"))
stats_pol_comb %<>% select(-exp)



# Extract the US users values for each Term
us_users_values <- stats_pol_comb %>%
  filter(Type == "US users") %>%
  select(Term, Mean, StdError, CI_lower, CI_upper) %>%
  rename(US_users_Mean = Mean, US_users_StdError = StdError, US_users_CI_lower = CI_lower, US_users_CI_upper = CI_upper)

# Join the US users values with the original dataframe
stats_pol_comb <- stats_pol_comb %>%
  left_join(us_users_values, by = "Term") %>%
  mutate(
    Mean = Mean / US_users_Mean,
    StdError = StdError / US_users_StdError,
    CI_lower = CI_lower / US_users_CI_lower,
    CI_upper = CI_upper / US_users_CI_upper
  ) %>%
  select(Term, Type, Label, Mean, StdError, CI_lower, CI_upper)

stats_pol_comb %<>% filter(Type!="US users")


stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-E", "High R-Not E", "Low R-E", "Low R-Not E") ~ "Twitter\nReach\n(R) by\nExpertise\n(E)",
  Type %in% c("1-100", "100+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country",
  Type %in% c("US users") ~ "US\nGeneral\nPopulation"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nExpertise\n(E)",
    "University\nRankings",
    "Country",
    "Field\nMatch",
    "US\nGeneral\nPopulation"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-E", "High R-Not E", "Low R-E", "Low R-Not E",
  "1-100", "100+",
  "US", "Non-US",
  "Does Culture", "Does Economics", "Does Neither",
  "US users"
))


# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-E" = "#A65628", "High R-Not E" = "#F781BF",
  "Low R-E" = "#999999", "Low R-Not E" = "gold2",
  "1-100" = "#1F78B4", "100+" = "#33A02C",
  "US" = "red3", "Non-US" = "grey40",
  "Does Culture" = "cyan3", "Does Economics" = "orange2", "Does Neither" = "grey40",
  "US users"="purple3"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Cultural\nliberalism","Economic\nCollectivism")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% econ_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value Relative to Average US General Population", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    
    # strip.background = element_rect(fill = NA, color = NA),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  # geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = 0.5, ymax = 0.6), fill = "gray90", inherit.aes = FALSE) +
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
# ggsave("AppFig5.jpg", p_all, width = 20, height = 22, dpi = 300)

```


Appendix Figure 6
```{r}
# Map the function over each variable group and combine results
stats_pol_main <- map_df(beh_var, ~calculate_stats(repl_df, .x))

stats_pol_is_female <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_female==1), .x))
stats_pol_is_male <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_male==1), .x))

stats_pol_is_stem <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_stem==1), .x))
stats_pol_is_soc_sci <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_soc_sci==1), .x))
stats_pol_is_humanities <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_humanities==1), .x))

stats_pol_type_H_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_H_cred==1), .x))
stats_pol_type_H_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_H_reach_L_cred==1), .x))
stats_pol_type_L_reach_H_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_H_cred==1), .x))
stats_pol_type_L_reach_L_cred <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(type_L_reach_L_cred==1), .x))

stats_pol_is_in_top_100_uni <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==1), .x))
stats_pol_is_in_top_100_uni_not <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_in_top_100_uni==0), .x))


stats_pol_is_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==1), .x))
stats_pol_isnt_US <- map_df(beh_var, ~calculate_stats(repl_df %>% filter(is_US==0), .x))

stats_pol_us_users <- map_df(beh_var, ~calculate_stats(users_df %>% filter(is_bot_50==0), .x))


stats_pol_field <- bind_rows(
  mutate(stats_pol_is_humanities, Type = "Humanities"),
  mutate(stats_pol_is_soc_sci, Type = "Soc. Sciences"),
  mutate(stats_pol_is_stem, Type = "STEM")
)
stats_pol_field$Type <- factor(stats_pol_field$Type, levels = c("Humanities", "Soc. Sciences", "STEM"))

stats_pol_reach_by_cred <- bind_rows(
  mutate(stats_pol_type_H_reach_H_cred, Type = "High R-High C"),
  mutate(stats_pol_type_H_reach_L_cred, Type = "High R-Low C"),
  mutate(stats_pol_type_L_reach_H_cred, Type = "Low R-High C"),
  mutate(stats_pol_type_L_reach_L_cred, Type = "Low R-Low C")
)
stats_pol_reach_by_cred$Type <- factor(stats_pol_reach_by_cred$Type, levels = c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C"))

stats_pol_gender <- bind_rows(
  mutate(stats_pol_is_female, Type = "Female"),
  mutate(stats_pol_is_male, Type = "Male")
)
stats_pol_gender$Type <- factor(stats_pol_gender$Type, levels = c("Female", "Male"))


stats_pol_rank <- bind_rows(
  mutate(stats_pol_is_in_top_100_uni, Type = "1-100"),
  mutate(stats_pol_is_in_top_100_uni_not, Type = "100+")
)
stats_pol_rank$Type <- factor(stats_pol_rank$Type, levels = c("1-100", "100+"))

stats_pol_US <- bind_rows(
  mutate(stats_pol_is_US, Type = "US"),
  mutate(stats_pol_isnt_US, Type = "Non-US")
)
stats_pol_US$Type <- factor(stats_pol_US$Type, levels = c("US", "Non-US"))

stats_pol_main$Type <- "Main"
stats_pol_main$Type <- factor(stats_pol_main$Type, levels = "Main")


stats_pol_us_users$Type <- "US users"
stats_pol_us_users$Type <- factor(stats_pol_us_users$Type, levels = "US users")


stats_pol_main$Label <- factor(stats_pol_main$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_field$Label <- factor(stats_pol_field$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_reach_by_cred$Label <- factor(stats_pol_reach_by_cred$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_gender$Label <- factor(stats_pol_gender$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_rank$Label <- factor(stats_pol_rank$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_US$Label <- factor(stats_pol_US$Term, levels = beh_var, labels = topic_label_mapping[beh_var])
stats_pol_us_users$Label <- factor(stats_pol_us_users$Term, levels = beh_var, labels = topic_label_mapping[beh_var])


stats_pol_comb <- bind_rows(stats_pol_main, stats_pol_field, stats_pol_reach_by_cred, stats_pol_gender, stats_pol_rank, stats_pol_US,stats_pol_us_users)

# Extract the US users values for each Term
us_users_values <- stats_pol_comb %>%
  filter(Type == "US users") %>%
  select(Term, Mean, StdError, CI_lower, CI_upper) %>%
  rename(US_users_Mean = Mean, US_users_StdError = StdError, US_users_CI_lower = CI_lower, US_users_CI_upper = CI_upper)

# Join the US users values with the original dataframe
stats_pol_comb <- stats_pol_comb %>%
  left_join(us_users_values, by = "Term") %>%
  mutate(
    Mean = Mean / US_users_Mean,
    StdError = StdError / US_users_StdError,
    CI_lower = CI_lower / US_users_CI_lower,
    CI_upper = CI_upper / US_users_CI_upper
  ) %>%
  select(Term, Type, Label, Mean, StdError, CI_lower, CI_upper)

stats_pol_comb %<>% filter(Type!="US users")

stats_pol_comb$Group <- with(stats_pol_comb, case_when(
  Type %in% c("Main") ~ "Main",
  Type %in% c("Female", "Male") ~ "Gender",
  Type %in% c("STEM", "Soc. Sciences", "Humanities") ~ "Fields",
  Type %in% c("High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C") ~ "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
  Type %in% c("1-100", "100+") ~ "University\nRankings",
  Type %in% c("US", "Non-US") ~ "Country",
  Type %in% c("US users") ~ "US\nGeneral\nPopulation"
))
stats_pol_comb$Group <- factor(
  stats_pol_comb$Group,
  levels = c(
    "Main", 
    "Gender",
    "Fields",
    "Twitter\nReach\n(R) by\nAcademic\nCredibility\n(C)",
    "University\nRankings",
    "Country",
    "US\nGeneral\nPopulation"
  )
)

# Ensure 'Type' has a proper order that reflects groupings
stats_pol_comb$Type <- factor(stats_pol_comb$Type, levels = c(
  "Main", "Female", "Male",
  "STEM", "Soc. Sciences", "Humanities",
  "High R-High C", "High R-Low C", "Low R-High C", "Low R-Low C",
  "1-100", "100+",
  "US", "Non-US",
  "US users"
))


# Color palette setup
color_values <- c(
  "Main" = "black",
  "Female" = "#E41A1C", "Male" = "#377EB8",
  "STEM" = "#4DAF4A", "Soc. Sciences" = "#FF7F00", "Humanities" = "#984EA3",
  "High R-High C" = "#A65628", "High R-Low C" = "#F781BF",
  "Low R-High C" = "#999999", "Low R-Low C" = "gold2",
  "1-100" = "#1F78B4", "100+" = "#33A02C",
  "US" = "red3", "Non-US" = "grey40",
  "US users"="purple3"
)

# Also map 'Label' correctly to factor
stats_pol_comb$Label <- factor(stats_pol_comb$Label, levels = unique(stats_pol_comb$Label))
  
stats_pol_comb$Label <- factor(
  stats_pol_comb$Label,
  levels = c("Egocentrism","Toxicity", "Emotionality/\nReasoning")
)

# Calculate the 'Main' mean for each Label (facet column)
main_means <- stats_pol_comb %>%
  filter(Type == "Main") %>%
  group_by(Label) %>%
  summarize(Main_Mean = mean(Mean, na.rm = TRUE))

# Merge this back to the main dataset for plotting
stats_pol_comb <- stats_pol_comb %>%
  left_join(main_means, by = "Label")

# Create the plot
p_all <- ggplot(stats_pol_comb %>% filter(Term %in% beh_var), aes(x = Mean, y = Type, color = Type, group = Type)) +
  geom_vline(data = main_means, aes(xintercept = Main_Mean), linetype = "dotted", color = "grey30", size = 1, alpha = 0.8) +  # Vertical line for Main mean
  geom_point(size = 8) +
  geom_errorbarh(aes(xmin = CI_lower, xmax = CI_upper), height = 0.2) +
  scale_color_manual(values = color_values) +
  labs(title = "Overview by Type", x = "Mean Value Relative to Average US General Population", y = "") +
  theme_classic(base_size = 33) +
  theme(
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    plot.title = element_blank(),
    legend.position = "none",
    axis.text.y = element_text(color="grey30", size=30),
    axis.text.x = element_text(angle=90),
    strip.text = element_text(face = "bold", angle = 0, size=35),
    strip.text.y.left = element_text(angle = 0, hjust=1, vjust = 1),
    
    # strip.background = element_rect(fill = NA, color = NA),
    strip.background = element_blank(),
    strip.placement = "outside",
    panel.spacing.y = unit(2, "lines"),  # Adjust spacing between rows
    panel.spacing.x = unit(2, "lines")  # Remove horizontal spacing
    # panel.border = element_rect(colour = "grey", fill = NA, size = 1)
    # panel.ontop = TRUE  # Panels on top to override default grid lines
    # plot.margin = margin(0, -2, 0, 0, unit = "pt") 
  ) +
  facet_grid(rows = vars(Group), cols = vars(Label), scales = "free", space = "free_y", switch = "y")+
  # geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = 0.5, ymax = 0.6), fill = "gray90", inherit.aes = FALSE) +
  geom_rect(data = data.frame(x = Inf), aes(xmin = -Inf, xmax = Inf, ymin = -0.04, ymax = 0), fill = "black", inherit.aes = FALSE)

# Print the plot
print(p_all)
# optionally, save the plot to view it clearly as it appears in the paper
# ggsave("AppFig6.jpg", p_all, width = 20, height = 22, dpi = 300)

```
